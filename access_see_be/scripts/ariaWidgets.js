/* access.see.be - Accessibility-Library for Prototype, www.access-see-be.net, Version 0.5
 * Copyright (C) 2008  diamonddogs web consulting gesmbh, www.diamonddogs.cc
 *  
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 *  
 * Component: ariaWidgets.js
 *
 *--------------------------------------------------------------------------*/

var AriaWidget=Class.create();AriaWidget.prototype={initialize:function(){this.wairole="Some Aria-Function"},setAriaHtmlOptions:function(B,A){if(A||Object.isUndefined(A)){B.setAttribute("id",this.wairole.getAriaName());switch(this.wairole){case"tablist":case"radiogroup":case"textbox":case"tree":case"group":case"menubar":case"listbox":null;break;case"tab":case"tabpanel":case"treeitem":case"option":B.setAttribute("tabIndex","-1");break;default:B.setAttribute("tabIndex","0")}!Object.isUndefined(this.htmlOptions["class"])?B.addClassName(this.htmlOptions["class"]):null;B.addClassName(Aria.delimiter).addClassName(this.wairole);switch(this.wairole){case"listbox":B.addClassName("expanded-false");B.addClassName("activedescendant-"+(new AriaCookie().has(B.identify())?new AriaCookie().get(B.identify()):"ariaOption_"+(widgetHash.get("option")+this.widgetOptions.indent.succ())));B.addClassName("haspopup-true");break;case"checkbox":B.addClassName("checked-"+($(this.widgetOptions.insert).checked?"true":"false"));break;case"menuitem":B.addClassName("checked-true");B.addClassName("haspopup-true");break;case"treeitem":this.widgetOptions.children?B.addClassName("expanded-"+(new AriaCookie().has(B.identify())?new AriaCookie().get(B.identify()):"false")):null;break;case"tab":B.addClassName("aria-tab-inactive");B.addClassName("disabled-"+this.widgetOptions.disabled);break;case"slider":B.addClassName("valuemin-"+this.widgetOptions.min);B.addClassName("valuemax-"+this.widgetOptions.max);B.addClassName("valuenow-"+(new AriaCookie().has(B.identify())?new AriaCookie().get(B.identify()):this.widgetOptions.indent));B.addClassName("labelledby-ariaSliderResult_"+widgetHash.get("slider"));break;case"button":B.addClassName("labelledby-ariaButtonLabel_"+widgetHash.get("button"));break;case"tabpanel":B.addClassName("labelledby-ariaTab_"+B.identify().splitForID());break;default:null}}else{this.htmlOptions["class"]?B.className=this.htmlOptions["class"]:null}Object.keys(this.htmlOptions.style).each(function(C){B.style[C]=this.htmlOptions.style[C]}.bind(this))},handleEvent:function(N){$("alertBox")?$("alertBox").remove():null;switch(this.wairole){case"button":if((N.type.include("click")&&N.button==0)||(N.type.include("keydown")&&N.keyCode==13)){if(this.widgetOptions.path){new AriaAjaxRequest(this.wairole,null,{url:ariaPath+"../"+this.widgetOptions.path}).create()}else{alert("No Goal for Button: "+this.name+'. Set "onclick"-Attribute')}}break;case"radio":if(Event.isLeftMouse(N)||Event.isSpaceKey(N)){$$("#ariaRadioGroup_"+this.widget.up().ancestors().first().identify().splitForID()+" ."+this.wairole).each(function(V){if(getARIAState($(V),NS_STATE,"checked")=="true"){setARIAState($(V),NS_STATE,"checked","false");this.widgetOptions.disableElements=true}}.bind(this))}case"checkbox":if(Event.isLeftMouse(N)||Event.isSpaceKey(N)){var G=getARIAState(this.widget,NS_STATE,"checked")=="true";setARIAState(this.widget,NS_STATE,"checked",G?"false":"true");$(this.widgetOptions.insert).checked=!G;this.displayElement(this.widget)}break;case"treeitem":var S=this.treeItem;var D=S;if(Event.isDownKey(N)||Event.isUpKey(N)){var J=N.keyCode==Event.KEY_DOWN?"down":"up";var I=J=="down"?S.identify().splitForID():S.identify().splitForID().decc().decc();do{var C=true;var Q=$$("#ariaTree_"+widgetHash.get("tree")+" .treeitem");if(I<Q.length&&I>=0){D=Q[I]}else{if(I==Q.length){D=Q.first()}else{D=Q[(Q.length.decc())]}}I=J=="down"?I.succ():I.decc();D.ancestors().each(function(V){if(!V.visible()){C=false}})}while(!C);D.focus()}if(Event.isLeftMouse(N)||Event.isRightKey(N)||Event.isLeftKey(N)){var E=Event.isLeftKey(N)?"close":"open";var H=S.up().next();if(!Object.isNull(H)){if(!Object.isUndefined(H)&&$(H).className.include("group")){var L=getARIAState($(S.identify()),NS_STATE,"expanded").toString().include("true")?true:false;if(!L&&E.include("open")||L&&E.include("close")||N.button==0){setARIAState($(S.identify()),NS_STATE,"expanded",!L);new AriaCookie().set(S.identify(),!L);new AriaAjaxRequest(this.wairole,S,this.widgetOptionsTree).create()}}}}S.setAttribute("tabIndex","-1");D.setAttribute("tabIndex","0");new AriaCookie().set("ariaTree_"+widgetHash.get("tree"),D.identify());break;case"tab":var S=$(Event.element(N).identify());if(Event.isRightKey(N)||Event.isLeftKey(N)){var D=S;if(Event.isLeftKey(N)){D=!Object.isNull(S.previous())?S.previous():$("ariaTab_"+this.widgetOptionsList.tabCounter)}else{if(Event.isRightKey(N)){D=!Object.isNull(S.next())?S.next():$("ariaTablist_"+this.widgetOptionsList.tablist).firstDescendant()}}D.focus()}if(Event.isFocused(N)||Event.isLeftMouse(N)||Event.isSpaceKey(N)){if(!this.widgetOptions.disabled){this.widgetOptionsList.focus=true;new AriaWidgetFunctions().activateTab(S,this.wairole,this.widgetOptionsList)}else{if(N.type.include("click")||N.type.include("keydown")){new AriaAlertBox(ariaPath+"../files/alert.html",{"class":"demoAlert"},S.identify())}}}break;case"listbox":case"option":var P=this.wairole.include("listbox")?$(this.widget):$(this.widget.up(0));var M=this.wairole.include("listbox")?this.widgetOptions:this.widgetOptionsList;var F=P.childElements().size();var B=getARIAState(P,NS_STATE,"activedescendant");var U=(F-Event.element(N).nextSiblings().size());if(Event.isLeftMouse(N)){var L=getARIAState(P,NS_STATE,"expanded").toString().include("true")?true:false;if(!L){if(!Object.isEmpty($$(".aria-listbox-list"))){$$(".aria-listbox-list").invoke("remove");$$(".listbox").each(function(V){setARIAState($(V),NS_STATE,"expanded",false)})}var A=Element.extend(new Element("span",{id:"ariaListboxPopUp_"+P.identify().splitForID(),"class":"aria-listbox-list"}));P.up(0).insert({after:A});P.childElements().each(function(W){var V=Element.extend(new Element("span"));V.update(W.innerHTML);V.cloneAttributes(W,new Array("class"));V.addClassName("aria-listbox-option");if(W.hasClassName("option")){V.observe("click",this.handleEvent.bindAsEventListener(this));W.identify()==B?V.addClassNameExt({bottom:"aria-option-active"}):V.removeClassName({bottom:"aria-option-active"})}A.insert({bottom:V})}.bind(this));if(!Object.isEmpty(M.optgroups)){M.optgroups.each(function(X){var W=Element.extend(new Element("span",{"class":"aria-listbox-optgroup"}));W.update(X.first());var V=parseInt(X[1]);A.childElements()[V].insert({before:W})}.bind(this));A.addClassName("aria-optgroup")}}else{U=$$("#ariaListboxPopUp_"+P.identify().splitForID()+" .aria-listbox-option").indexOf(Event.element(N));if(Event.element(N).up(0).identify().include("ariaListboxPopUp_"+P.identify().splitForID())){$(B).addClassNameExt({bottom:"aria-option-hide"});$(B).setAttribute("tabIndex","-1");B=P.childElements()[U].identify()}$("ariaListboxPopUp_"+P.identify().splitForID()).remove()}setARIAState(P,NS_STATE,"expanded",!L)}else{if(Event.isRightKey(N)||Event.isLeftKey(N)||Event.isUpKey(N)||Event.isDownKey(N)){var J=Event.isRightKey(N)||Event.isDownKey(N)?"down":"up";var K=(J.include("down")?(U==F?0:U):(U==1?F.decc():U.decc().decc()));var T=P.childElements()[K];$(B).addClassNameExt({bottom:"aria-option-hide"});$(B).setAttribute("tabIndex","-1");B=T.identify()}}setARIAState(P,NS_STATE,"activedescendant",B);$(B).removeClassName("aria-option-hide");$(B).setAttribute("tabIndex","0");$(B).focus();$(M.insert).options[($(B).siblings().size().succ()-$(B).nextSiblings().size()).decc()].selected=true;new AriaCookie().set(P.identify(),getARIAState(P,NS_STATE,"activedescendant"));break;case"slider":var P=$(this.widgetOptions.widgetSlider);var O=parseInt(getARIAState(P,NS_STATE,"valuenow"));var R=Event.element(N).className.include("left")?"left":"right";switch(N.keyCode){case Event.KEY_LEFT:if(R!="right"||Event.element(N).hasClassName("slider")){O-=this.widgetOptions.increment}break;case Event.KEY_RIGHT:if(R!="left"||Event.element(N).hasClassName("slider")){O+=this.widgetOptions.increment}break;case Event.KEY_PAGEDOWN:O-=this.widgetOptions.incrementStep;break;case Event.KEY_PAGEUP:O+=this.widgetOptions.incrementStep;break;case Event.KEY_HOME:O=this.widgetOptions.min;break;case Event.KEY_END:O=this.widgetOptions.max;break;default:if(N.type=="click"){O=(R=="left")?O-this.widgetOptions.increment:O+this.widgetOptions.increment}}if(O<this.widgetOptions.min){O=this.widgetOptions.min}else{if(O>this.widgetOptions.max){O=this.widgetOptions.max}}$(this.widgetOptions.insert).options[this.widgetOptions.values.indexOf(O)].selected=true;setARIAState(P,NS_STATE,"valuenow",O);new AriaCookie().set(P.identify(),O);P.setStyle({marginLeft:this.widgetOptions.step*this.widgetOptions.values.indexOf(O)+"px"});$(this.widgetOptions.widgetSliderOverlay).setStyle({marginLeft:this.widgetOptions.step*this.widgetOptions.values.indexOf(O)+"px"});$(this.widgetOptions.widgetSliderResultTag).update(O);if(this.widgetOptions.buttons.toString().include("true")){$(this.widgetOptions.widgetSliderButtonDescription).update("Slider position "+O+". Updated position will not be announced!")}if(Event.isMouseuped(N)){P.focus()}}},insertElementIntoDOM:function(B,A){switch(A){case"after":$(this.widgetOptions.insert).insert({after:B});break;case"bottom":$(this.widgetOptions.insert).insert({bottom:B});break;default:$(this.widgetOptions.insert).insert({before:B})}if(this.widgetOptions.wrap){B.wrap(new Element("span",{"class":"ariaElementWrapper aria"+this.wairole.capitalize()+"Wrapper",id:"aria"+this.wairole.capitalize()+"Wrapper_"+widgetHash.get(this.wairole)}))}initContent(B);new AriaMyFunction(this.wairole)}};var AriaButton=Class.create();AriaButton.prototype=Object.extend(new AriaWidget(),{initialize:function(B,E,F,A){this.wairole="button";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.name=B;this.htmlOptions=E;this.widgetOptions=F;var C=Element.extend(new Element("span"));this.setAriaHtmlOptions(C);C.innerHTML=this.name;this.widgetOptions.height?C.setStyle({width:this.widgetOptions.height+"px",height:this.widgetOptions.height+"px"}):null;var D=new Element("span",{id:"ariaButtonLabel_"+widgetHash.get("button"),"class":"invisible"});this.widgetOptions.label?D.update(this.widgetOptions.label):D.update(this.name);C.insert({top:D});this.button=C;if(!A){this.insertElementIntoDOM(C);$(C).observe("click",this.handleEvent.bindAsEventListener(this));$(C).observe("keydown",this.handleEvent.bindAsEventListener(this))}},embedd:function(){return this.button}});var AriaListbox=Class.create();AriaListbox.prototype=Object.extend(new AriaWidget(),{initialize:function(A,E,F){this.wairole="listbox";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=E;this.widgetOptions=F;var D=Element.extend(new Element("span"));this.setAriaHtmlOptions(D);this.insertElementIntoDOM(D);this.widget=D;this.widgetOptions.height=Object.isNull(D.getStyle("height"))?null:D.getStyle("height").replace("px",new String());A.each(function(G){G[2].insert=D.identify();new AriaOption(G.first(),G[1],G[2],F)}.bind(this));var C=new AriaCookie().has(this.wairole.getAriaName())?$(new AriaCookie().get(this.wairole.getAriaName())):D.descendants()[this.widgetOptions.indent];C.removeClassName("aria-option-hide");C.setAttribute("tabIndex","0");var B=Element.extend(new Element("span",{"class":"aria-listbox-button"}));B.setStyle({height:this.widgetOptions.height+"px",width:this.widgetOptions.height+"px"});this.widgetOptions.position.include("right")?D.insert({after:B}):D.insert({before:B});B.observe("click",this.handleEvent.bindAsEventListener(this))}});var AriaOption=Class.create();AriaOption.prototype=Object.extend(new AriaWidget(),{initialize:function(A,D,E,B){this.wairole="option";this.name=A;this.htmlOptions=D;this.widgetOptions=E;this.widgetOptionsList=B;widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));var C=new Element("span");this.setAriaHtmlOptions(C);C.update(this.name);C.addClassNameExt({bottom:"aria-option-hide"});C.observe("click",this.handleEvent.bindAsEventListener(this));C.observe("keydown",this.handleEvent.bindAsEventListener(this));this.widget=C;this.insertElementIntoDOM(C,"bottom");this.widgetOptionsList.height=this.widgetOptionsList.height>0?this.widgetOptionsList.height:C.getHeight();C.setStyle({height:(this.widgetOptionsList.height-parseInt(C.getStyle("paddingTop")))+"px"})}});var AriaSlider=Class.create();AriaSlider.prototype=Object.extend(new AriaWidget(),{initialize:function(L,B){this.wairole="slider";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=L;this.widgetOptions=B;this.widgetOptions.size=(this.widgetOptions.size?parseInt(this.widgetOptions.size):this.widgetOptions.max*parseInt(this.widgetOptions.width))+parseInt(this.widgetOptions.width);this.widgetOptions.step=(this.widgetOptions.size-parseInt(this.widgetOptions.width))/this.widgetOptions.values.size().decc();var D=new Element("span",{"class":"aria-Slider-Group",id:"ariaSliderGroup_"+widgetHash.get("slider")});var J=new Element("span",{"class":"aria-slider-Slider",id:"ariaSlideArea_"+widgetHash.get("slider")});J.setStyle({width:this.widgetOptions.size+"px",height:this.widgetOptions.height+"px"});var G=new Element("span");this.setAriaHtmlOptions(G);G.setStyle({width:this.widgetOptions.width+"px",height:this.widgetOptions.height+"px"});G.update(new String());this.widgetOptions.widgetSlider=G;var K=new Element("label",{"class":"aria-slider-Result",id:"ariaSliderResult_"+widgetHash.get("slider"),"for":G.identify()});this.widgetOptions.widgetSliderResultTag=K;if(new AriaCookie().has(G.identify())){var E=parseInt(new AriaCookie().get(G.identify()))}else{var E=parseInt(this.widgetOptions.indent?this.widgetOptions.indent:this.widgetOptions.min)}var I=parseInt(this.widgetOptions.values.indexOf(E));G.setStyle({marginLeft:I*this.widgetOptions.step+"px"});K.update(E);$(this.widgetOptions.insert).options[I].selected=true;D.insert({top:J.insert({top:G})});D.insert({bottom:K});if(this.widgetOptions.buttons.toString().include("true")){var A=new AriaButton(new String(),{"class":"aria-slider-Button-left",id:"ariaSliderButtonLeft_"+widgetHash.get("slider")},{width:this.widgetOptions.height,height:this.widgetOptions.height,label:"Decrease Value"},true);var C=new AriaButton(new String(),{"class":"aria-slider-Button-right",id:"ariaSliderButtonRight_"+widgetHash.get("slider")},{width:this.widgetOptions.height,height:this.widgetOptions.height,label:"Increase Value"},true);J.insert({before:A.embedd()});J.insert({after:C.embedd()})}if(this.widgetOptions.buttons.toString().include("true")){$(A.embedd()).observe("click",this.handleEvent.bindAsEventListener(this));$(A.embedd()).observe("keydown",this.handleEvent.bindAsEventListener(this));$(C.embedd()).observe("click",this.handleEvent.bindAsEventListener(this));$(C.embedd()).observe("keydown",this.handleEvent.bindAsEventListener(this))}$(G).observe("keydown",this.handleEvent.bindAsEventListener(this));$(G).observe("mouseup",this.handleEvent.bindAsEventListener(this));var H=new Element("span",{id:"sliderOverlay_"+widgetHash.get(this.wairole),"class":"aria-slider-Overlay"});H.setStyle({width:$(G).style.width,height:$(G).style.height,marginLeft:$(G).style.marginLeft});H.setAttribute("tabindex","-1");$(G).insert({before:H});this.widgetOptions.widgetSliderOverlay=H;H.observe("keydown",this.handleEvent.bindAsEventListener(this));H.observe("mouseup",this.handleEvent.bindAsEventListener(this));this.insertElementIntoDOM(D);if(this.widgetOptions.buttons.toString().include("true")){var F=new Element("span",{id:"ariaSliderButtonDescription_"+widgetHash.get("slider"),"class":"invisible"});F.update("Slider position "+I+". Updated position will not be announced!");D.insert({bottom:F});this.widgetOptions.widgetSliderButtonDescription=F;setARIAState($(A.embedd()),NS_STATE,"describedby",F.identify());setARIAState($(C.embedd()),NS_STATE,"describedby",F.identify())}new AriaDraggableElement(this.widgetOptions,widgetHash.get("slider"))}});var AriaAlertBox=Class.create();AriaAlertBox.prototype=Object.extend(new AriaWidget(),{initialize:function(B,C,A){this.wairole="alert";this.file=B;this.focus=A;request=new AriaAjaxRequest(this.wairole,null,{url:this.file,focus:this.focus});request.create()}});var AriaCheckboxRadioGroup=Class.create();AriaCheckboxRadioGroup.prototype=Object.extend(new AriaWidget(),{init:function(A,C,D){this.name=A;this.htmlOptions=C;this.widgetOptions=D;this.widgetOptions.path=ariaImagePath+this.wairole;this.widgetOptions.status="/"+this.wairole+".swf";var B=Element.extend(new Element("span"));this.setAriaHtmlOptions(B);this.insertElementIntoDOM(B);this.initElement(B)},initElement:function(C){this.widget=C;var A=new Element("span",{"class":"aria-"+this.wairole+"-text"});A.insert({bottom:this.name});C.insert({top:A});if(Aria.supports.flash&&this.widgetOptions.format.include("swf")){new AriaFlashObject().init(C,this.wairole,this.widgetOptions)}else{var B=Element.extend(new Element("span",{"class":"aria-"+this.wairole+"-box"}));var D=Element.extend(new Element("img",{"class":Aria.delimiter+" presentation",alt:this.wairole}));$(C).insert({top:B});$(B).insert({top:D});initContent(D);this.displayElement(C)}C.observe("keydown",this.handleEvent.bindAsEventListener(this));C.observe("click",this.handleEvent.bindAsEventListener(this))},displayElement:function(A){new AriaAjaxRequest(this.wairole,A,this.widgetOptions).create()}});var AriaCheckbox=Class.create();AriaCheckbox.prototype=Object.extend(new AriaCheckboxRadioGroup(),{initialize:function(A,B,C){this.wairole="checkbox";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.init(A,B,C)}});var AriaRadioButton=Class.create();AriaRadioButton.prototype=Object.extend(new AriaCheckboxRadioGroup(),{initialize:function(A,B,C){this.wairole="radio";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.init(A,B,C)}});var AriaRadioGroup=Class.create();AriaRadioGroup.prototype=Object.extend(new AriaWidget(),{initialize:function(B){this.wairole="radiogroup";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=new Object();var C=$A();B.each(function(D){new AriaRadioButton(D.first(),D[1],D[2]);C.push("#ariaRadioWrapper_"+widgetHash.get("radio"))}.bind(this));var A=new Element("span");this.setAriaHtmlOptions(A);A.setAttribute("id","ariaRadioGroup_"+widgetHash.get("radiogroup"));$$(C.join(",")).wrap(A);initContent(A)}});var AriaTextfield=Class.create();AriaTextfield.prototype=Object.extend(new AriaWidget(),{initialize:function(C,D){this.wairole="textfield";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=C;this.widgetOptions=D;var B=new Element("span");this.setAriaHtmlOptions(B);var A=new Element("input",{type:"text",id:"ariaTextfield_"+widgetHash.get(this.wairole)});B.insert({top:A});this.insertElementIntoDOM(B,"bottom")}});var AriaMenu=Class.create();AriaMenu.prototype=Object.extend(new AriaWidget(),{initialize:function(B,C,E){this.wairole="menubar";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=C;this.widgetOptions=E;var A=0;var D=$A();var F=new Element("div");this.setAriaHtmlOptions(F);B.each(function(G){new AriaMenuitem(G.first(),G[1],G[2]);D[A]="#ariaMenuitem_"+widgetHash.get("menuitem");A++}.bind(this));$$(D.join(",")).wrap(F);initContent(F)}});var AriaMenuitem=Class.create();AriaMenuitem.prototype=Object.extend(new AriaWidget(),{initialize:function(A,B,D){this.wairole="menuitem";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.name=A;this.htmlOptions=B;this.widgetOptions=D;var C=new Element("span");this.setAriaHtmlOptions(C);C.innerHTML=this.name;this.menuitem=C;this.insertElementIntoDOM(C);this.initElement($(C))},initElement:function(A){A.observe("click",this.handleEvent.bindAsEventListener(this));A.observe("keydown",this.handleEvent.bindAsEventListener(this))}});var AriaTablist=Class.create();AriaTablist.prototype=Object.extend(new AriaWidget(),{initialize:function(A,C,D){this.wairole="tablist";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=C;this.widgetOptions=D;D.tablist=widgetHash.get("tablist");D.tabCounter=0;var B=new Element("div");this.setAriaHtmlOptions(B);this.insertElementIntoDOM(B);$$(".aTabpanel").each(function(E){E.hide()}.bind(this));A.each(function(E){E[2].insert=B.identify();new AriaTab(E.first(),E[1],E[2],D)}.bind(this));if(new AriaCookie().has(this.wairole.getAriaName())){new AriaWidgetFunctions().activateTab($(new AriaCookie().get(this.wairole.getAriaName())),this.wairole,this.widgetOptions)}else{if(this.widgetOptions.active){new AriaWidgetFunctions().activateTab(this.widgetOptions.active,this.wairole,this.widgetOptions)}}}});var AriaTab=Class.create();AriaTab.prototype=Object.extend(new AriaWidget(),{initialize:function(A,D,E,B){this.wairole="tab";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.name=A;this.htmlOptions=D;this.widgetOptions=E;this.widgetOptionsList=B;var C=new Element("span");this.setAriaHtmlOptions(C);C.innerHTML=this.name.stripTags();this.tab=C;this.insertElementIntoDOM(C,"bottom");this.initElement($(C))},initElement:function(B){B.observe("click",this.handleEvent.bindAsEventListener(this));B.observe("keydown",this.handleEvent.bindAsEventListener(this));B.observe("focus",this.handleEvent.bindAsEventListener(this));if(getARIAState($$(".aTabpanel")[widgetHash.get("tab").decc()],NS_STATE,"role")!="wairole:tabpanel"){$$(".aTabpanel")[widgetHash.get("tab").decc()].setAttribute("id","ariaTabpanel_"+widgetHash.get("tab"));$$(".aTabpanel")[widgetHash.get("tab").decc()].className+=" "+Aria.delimiter+"tabpanel labelledby-ariaTab_"+widgetHash.get("tab");initContent($$(".aTabpanel")[widgetHash.get("tab").decc()]);if(this.widgetOptionsList.buttons.toString().include("true")){if(this.widgetOptionsList.tabCounter!=0){var A=new AriaButton("Step "+widgetHash.get("tab").decc(),{"class":"demoButton"},{path:"demo/wizard/action"+widgetHash.get("tab").decc()+".js",label:"Step "+widgetHash.get("tab").decc(),insert:$$(".aTabpanel")[widgetHash.get("tab").decc()]});$$(".aTabpanel")[widgetHash.get("tab").decc()].insert({bottom:A.embedd()})}if(this.widgetOptionsList.tabCounter!=$$(".aTabpanel").size().decc()){var A=new AriaButton("Step "+widgetHash.get("tab").succ(),{"class":"demoButton"},{path:"demo/wizard/action"+widgetHash.get("tab").succ()+".js",label:"Step "+widgetHash.get("tab").succ(),insert:$$(".aTabpanel")[widgetHash.get("tab").decc()]});$$(".aTabpanel")[widgetHash.get("tab").decc()].insert({bottom:A.embedd()})}}this.widgetOptionsList.tabCounter+=1}if(this.widgetOptions.active){this.widgetOptionsList.active=B}}});var AriaTabpanel=Class.create();AriaTabpanel.prototype=Object.extend(new AriaWidget(),{initialize:function(B,C){this.wairole="tabpanel";this.htmlOptions=B;this.widgetOptions=C;var A=new Element("span");this.setAriaHtmlOptions(A);this.insertElementIntoDOM(A)}});var AriaTree=Class.create();AriaTree.prototype=Object.extend(new AriaWidget(),{initialize:function(A,F,G){this.wairole="tree";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=F;this.widgetOptions=G;var B=new Object();var E=new Element("span");this.setAriaHtmlOptions(E);this.insertElementIntoDOM(E);var D=new Object();D.style=new Object();var C=new Object();A.each(function(H){H[2].insert=E.identify();treeItem=new AriaTreeItem(H.first(),H[1],H[2],G);if(H[2].children>0){B[treeItem.get().identify()]=H[2].children}}.bind(this));Object.keys(B).each(function(K){var N=parseInt(K.splitForID()).succ();var H=(parseInt(N)+parseInt(B[K])).decc();var J=H-N;for(var I=N;I<=H;I++){if(B["ariaTreeitem_"+I]){H+=parseInt(B["ariaTreeitem_"+I])}}D.style.display=new AriaCookie().has(K)?(new AriaCookie().get(K).include("true")?"inline":"none"):"none";var L=new AriaGroup(D,C,true);var M=$R(N,H).map(function(O){return"#ariaTreeitemWrapper_"+O});$$(M).wrap(L.get());initContent(L.get())}.bind(this));new AriaCookie().has(this.wairole.getAriaName())?$(new AriaCookie().get(this.wairole.getAriaName())).setAttribute("tabIndex","0"):E.firstDescendant().down().setAttribute("tabIndex","0")}});var AriaTreeItem=Class.create();AriaTreeItem.prototype=Object.extend(new AriaWidget(),{initialize:function(A,D,G,E){this.wairole="treeitem";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=D;this.widgetOptions=G;this.widgetOptionsTree=E;var C=Element.extend(new Element("span"));this.setAriaHtmlOptions(C);var F=new Element("span",{"class":"aria-"+this.wairole+"-text"});F.update(A);$(C).insert({bottom:F});this.insertElementIntoDOM(C,"bottom");this.treeItem=C;this.widgetOptionsTree.status="/"+(this.widgetOptions.children?(new AriaCookie().has(C.identify())?(new AriaCookie().get(C.identify()).include("true")?"static/opened":"static/closed"):"static/closed"):"static/none")+"."+this.widgetOptionsTree.format;this.widgetOptionsTree.path=ariaImagePath+this.wairole;if(Aria.supports.flash&&this.widgetOptionsTree.format.include("swf")){new AriaFlashObject().init(this.treeItem,this.wairole,this.widgetOptionsTree)}else{var B=Element.extend(new Element("span",{"class":"aria-"+this.wairole+"-box"}));var H=Element.extend(new Element("img",{"class":Aria.delimiter+" presentation",alt:this.wairole,src:this.widgetOptionsTree.path+this.widgetOptionsTree.status}));$(C).insert({top:B});$(B).insert({top:H});initContent(H)}$(C).observe("click",this.handleEvent.bindAsEventListener(this));$(C).observe("keydown",this.handleEvent.bindAsEventListener(this))},get:function(){return this.treeItem}});var AriaGroup=Class.create();AriaGroup.prototype=Object.extend(new AriaWidget(),{initialize:function(B,D,A){this.wairole="group";widgetHash.set(this.wairole,(widgetHash.get(this.wairole).succ()));this.htmlOptions=B;this.widgetOptions=D;var C=new Element("span");this.setAriaHtmlOptions(C);this.group=C;if(!A){this.insertElementIntoDOM(C,"after")}},get:function(){return this.group}});var AriaWidgetFunctions=Class.create();AriaWidgetFunctions.prototype={initialize:function(){},removeInitialPreloader:function(){if($("ariaInitialPreloader").remove()){$$(".contentArea").first().firstDescendant().style.display="block";$$(".contentArea").first().style.height="auto"}},activateTab:function(C,A,B){$$("#ariaTablist_"+B.tablist+" span."+A).each(function(D){if(getARIAState($(D),NS_STATE,"disabled")=="false"){$(D).setAttribute("tabIndex","-1");$(D).changeClassName("aria-tab-active","aria-tab-inactive");setARIAState($(D),NS_STATE,"disabled","true");$(D).changeClassName("aria-tab-inactive","aria-tab-active");$("ariaTabpanel_"+D.identify().splitForID()).hide()}}.bind(this));setARIAState(C,NS_STATE,"disabled","false");C.changeClassName("aria-tab-active","aria-tab-inactive");C.setAttribute("tabIndex","0");$("ariaTabpanel_"+C.identify().splitForID()).style.display="block";C.isVisible()&&B.focus?C.focus():null;new AriaCookie().set("ariaTablist_"+widgetHash.get("tablist"),C.identify())}};var AriaDraggableElement=Class.create();AriaDraggableElement.prototype={initialize:function(B,A){this.widgetOptions=B;this.widgetSlider=this.widgetOptions.widgetSliderOverlay;this.actSlider=A;this.objImage=new Object();$(this.widgetSlider).observe("mousedown",this.startDrag.bindAsEventListener(this))},startDrag:function(A){this.objImage=A.target;this.offset=$("ariaSlideArea_"+this.actSlider).viewportOffset().first();$(this.widgetOptions.widgetSlider).setStyle({backgroundPosition:"left bottom"});this.mousemove=this.drag.bindAsEventListener(this);Event.observe(document,"mousemove",this.mousemove);this.mouseup=this.endDrag.bindAsEventListener(this);Event.observe(document,"mouseup",this.mouseup)},drag:function(B){var A=this.widgetOptions.values.indexOf(parseInt(getARIAState($(this.widgetOptions.widgetSlider),NS_STATE,"valuenow")));var D=B.clientX-this.offset;var C=(parseInt(getARIAState($(this.widgetOptions.widgetSlider),NS_STATE,"valuenow")/this.widgetOptions.increment)*this.widgetOptions.step);if(D>C){C=C+this.widgetOptions.step;A=A.succ()}else{C=C-this.widgetOptions.step;A=A.decc()}if(D>C&&D<this.widgetOptions.size&&D>this.widgetOptions.min){var E=parseInt(this.widgetOptions.values[A]);$("ariaSliderResult_"+this.actSlider).firstChild.data=E;$(this.widgetOptions.insert).options[A].selected=true;$(this.widgetSlider).setStyle({marginLeft:C+"px"});$(this.widgetOptions.widgetSlider).setStyle({marginLeft:C+"px"});setARIAState($(this.widgetOptions.widgetSlider),NS_STATE,"valuenow",E);new AriaCookie().set($(this.widgetOptions.widgetSlider).identify(),E)}},endDrag:function(A){$(this.widgetOptions.widgetSlider).setStyle({backgroundPosition:"left top"});Event.stopObserving(document,"mousemove",this.mousemove);Event.stopObserving(document,"mouseup",this.mouseup);this.objImage=new Object()}};