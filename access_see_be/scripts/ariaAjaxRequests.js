/* access.see.be - Accessibility-Library for Prototype, www.access-see-be.net, Version 0.5
 * Copyright (C) 2008  diamonddogs web consulting gesmbh, www.diamonddogs.cc
 *  
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 *  
 * Component: ariaAjaxRequest.js
 *
 *--------------------------------------------------------------------------*/

var AriaAjaxRequest=Class.create();AriaAjaxRequest.prototype={initialize:function(A,B,C){this.wairole=A;this.element=B;this.widgetOptions=C;this.url=this.widgetOptions.url?this.widgetOptions.url:"/"},create:function(){Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++;var A=Element.extend(new Element("div",{"class":Aria.delimiter+" progressbar",id:"ariaPreloader",tabindex:0}));$(new AriaMyFunction().preloadArea).insert({top:A});initContent(A);var C=new Element("img",{"class":Aria.delimiter+" presentation",src:ariaPath+"../images/aria/preloader_main.gif",alt:"Preloader-Image"});var B=new Element("div");var D=document.createTextNode("Loading ...");A.insert({top:C});A.insert({bottom:B})}.bind(this),onComplete:function(){Ajax.activeRequestCount--;if($("ariaPreloader")){setTimeout("$('ariaPreloader').remove()",500)}if(Ajax.activeRequestCount==0){}}.bind(this)});new Ajax.Request(this.url,{method:"get",onSuccess:function(K){switch(this.wairole){case"application":initWidgets();break;case"alert":var D=Element.extend(new Element("div",{"class":Aria.delimiter+" alert",id:"alertBox",tabindex:0}));$$("body").first().insert({bottom:D});initContent(D);var B=new Element("img",{"class":Aria.delimiter+" presentation",src:ariaPath+"../images/aria/info.png",alt:"Info-Image"});initContent(B);D.insert({top:B});D.insert({bottom:"<br />"+K.responseText});D.insert({bottom:'<br /><br /><a href="javascript:void(0)" onclick="request.remove()">close</a>'});D.focus();break;case"radio":case"checkbox":var I=getARIAState(this.element,NS_STATE,"checked")=="true";var A=ariaImagePath+this.wairole+"/checked."+this.widgetOptions.format;var C=ariaImagePath+this.wairole+"/unchecked."+this.widgetOptions.format;if(this.widgetOptions.disableElements){var J=false;$$("#"+$(this.element).up().ancestors().first().identify()+" .radio").each(function(L){L.descendants().each(function(N){switch(N.tagName.toLowerCase()){case"img":N.src=N.src.replace("/checked","/unchecked");break;case"object":case"embed":if(Aria.supports.ff[2]){J=N.data.include("/checked")}else{if(Aria.supports.opera){J=N.src.include("/checked")}else{J=N.innerHTML.include("/checked")}}if(J){var M={movie:ariaImagePath+this.wairole+"/unchecked.swf",width:this.widgetOptions.width,height:this.widgetOptions.height};new AriaFlashObject().setup(M,L.identify().replace("Radio_","RadioFlash_"))}break}}.bind(this))}.bind(this))}if(Aria.supports.flash&&this.widgetOptions.format.include("swf")){var G=I?A:C;var E={movie:G,width:this.widgetOptions.width,height:this.widgetOptions.height};new AriaFlashObject().setup(E,"aria"+this.wairole.capitalize()+"Flash_"+this.element.identify().splitForID())}else{var B=this.element.getElementsByTagName("img")[0];B.src=I?A:C}break;case"treeitem":var F=getARIAState($(this.element.identify()),NS_STATE,"expanded").toString().include("true")?true:false;var A=ariaImagePath+this.wairole+"/"+(this.widgetOptions.format.include("swf")?"animated":"static")+"/opened."+this.widgetOptions.format;var C=ariaImagePath+this.wairole+"/"+(this.widgetOptions.format.include("swf")?"animated":"static")+"/closed."+this.widgetOptions.format;var G=F?A:C;var H=$(this.element).up().next().getStyle("display")=="none"?"inline":"none";if(Aria.supports.flash&&this.widgetOptions.format.include("swf")){var E={movie:G,width:this.widgetOptions.width,height:this.widgetOptions.height};new AriaFlashObject().setup(E,$(this.element).down(1).identify())}else{var B=$$("#"+this.element.identify()+" img").first();B.src=F?A:C}$(this.element).up().next().setStyle({display:H});if(Aria.supports.ff[2]||Aria.supports.opera){$$("#"+$(this.element).up().next().id+" object").each(function(M){if($(M).data.include("animated/closed")||$(M).data.include("animated/opened")){var L={movie:this.widgetOptions.path+"/static/"+$(M).data.split("/")[($(M).data.split("/").length)-1],width:this.widgetOptions.width,height:this.widgetOptions.height};new AriaFlashObject().setup(L,$(M).up().id)}}.bind(this))}break;default:}}.bind(this)})},remove:function(){new Ajax.Request(request.url,{method:"get",parameters:request.params,onSuccess:function(A){switch(request.wairole){case"alert":$("alertBox").remove();$(this.widgetOptions.focus).focus();break}}.bind(this)})}};